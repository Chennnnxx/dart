extends ../ui_layout

block content
  
  .ui.text.container(style="margin-bottom:4em;")
    br
    .column
      .ui.raised.segment
        h3.ui.header
          i.binoculars.blue.icon
          .content
            | Explore
        hr
          
        h5.ui.header
          i.arrow.circle.right.blue.icon
          .content
            |  Before exploring the TestDrive timeline, take a moment to explore a page based on your interests. 
      
          
        h5.ui.header
          i.arrow.circle.right.blue.icon
          .content
            |  Choose a topic below to learn more!
        br
        .ui.container
          form.ui.form
              .field#animateDropdownError
                label(style="font-size:120%;")
                  i.search.large.gray.icon
                  .ui.selection.dropdown(name='topicSelect')
                    input(type='hidden')
                    i.dropdown.icon
                    .default.text Choose a topic...
                    .menu
                      .item(data-value='0' style="font-size:100%") Food
                      .item(data-value='1' style="font-size:100%") Sports
                      .item(data-value='2' style="font-size:100%") Gaming
      br
      br

    br
    br
    .ui.warning.message#selectTopicError(style="display:none;")
     .header
      | Select an interest to proceed 
      
    a(href='javascript:void(0);', onclick='javascript:startIntro();')
        .ui.big.labeled.icon.button
            i.rocket.icon
            |   Let's Continue!
    br
    br
    br
    
block scripts
  script().
  
    $('.ui.dropdown')
      .dropdown();
      
    $(".ui.selection.dropdown[name='topicSelect']").change(function() {
          $('.ui.big.labeled.icon.button').addClass('green');
          $('#selectTopicError').hide();
          var newSelect = ($(".ui.selection.dropdown[name='topicSelect']").dropdown('get text'));
          $.post("/feed", { targetedAdTopic: newSelect, _csrf: $('meta[name="csrf-token"]').attr('content') });
    });
    
    $('.ui.big.labeled.icon.button').on('click',function(){
      if(!$(this).hasClass('green')){
        $('#selectTopicError').show();
        $("#animateDropdownError").transition('bounce');
      }
    })
      
      
    function startIntro(){
      
      var currentSelect = ($(".ui.selection.dropdown[name='topicSelect']").dropdown('get text'));
      
      //record the choice in the db to use later when generating the free play section 
      $.post("/interest", { chosenTopic: currentSelect, _csrf: $('meta[name="csrf-token"]').attr('content') });
      
      //take the user to the appropriate interest page depending on their choice
      if($('.ui.big.labeled.icon.button').hasClass('green')){     
        if(currentSelect === "Food"){
          window.location.href='/food/targeted';
        }else if (currentSelect === "Sports"){
          window.location.href='/sports/targeted';
        }else if (currentSelect === "Gaming"){
          window.location.href='/gaming/targeted';
        }
      }
      
      
    };
