
extends ../ui_layout
  
block content
  -var cdn = "https://dhpd030vnpk29.cloudfront.net";

  
  .computer.only.tablet.only.four.wide.column 
  #content.eight.wide.computer.ten.wide.tablet.sixteen.wide.mobile.column()

    #blueDotStep.ui.fluid.card.dim
      .ui.dimmer.flag
        .content
          .center
            h2.ui.inverted.icon.header
              i.red.flag.icon
              |                                     You &apos;ve reported this ad!
              h3.ui.inverted.header
                span The admins will review this ad further. We are sorry you had this experience.
                
      .ui.inverted.dimmer.notflag
        .content
          .center
            h2.ui.inverted.icon.header
              i.eye.slash.icon(style="color:black;")
              h1.ui.header(style="color:black;") You&apos;ve hidden this ad!
            

      .content(data-hint="This is a sponsored post from a guitar company. You can see that the post looks very similar to other social media posts.", data-hintPosition="middle-middle")
          
        .ui.right.floated.menu(style="border:none; box-shadow:none;" data-hint="Try clicking the three dots and then ‚ÄúWhy am I seeing this ad?‚Äù to learn more about how the website decided to show you the advertisement." data-hintPosition="bottom-right")
          .ui.dropdown.icon.item
            i.ellipsis.horizontal.icon
            .menu.fluid.floated.left#item1
              .item(data-value='0')
                i.fitted.circular.close.icon(style="color:gray;")
                | Hide Ad
              .item(data-value='1')
                i.fitted.circular.exclamation.icon(style="color:gray;")
                | Report Ad
              .item(data-value='2')
                i.fitted.circular.question.icon(style="color:gray;") 
                | Why Am I Seeing This Ad?
                  
        a.left.floated(href='/user/goldenguitarsca')
          img.ui.avatar.image(src=cdn+'/profile_pictures/golden_guitars_pfp.jpg')
          span(style="vertical-align:middle;")#companyName='Golden Guitars'

      .image
        img.post(src=cdn+'/post_pictures/golden_guitar_ad.jpg')

      #step4.content
        .description(data-hint='One way you can tell that this post is an advertisement is by looking for words like ‚ÄúAD,‚Äù ‚ÄúAdvertisement,‚Äù ‚ÄúPromoted,‚Äù or ‚ÄúSponsored.‚Äù' data-hintPosition="middle-right")
          | You can be the best with Golden Guitars.
          span#hashtag  #advertisement
        //-.right.floated.meta
          i.icon.checkmark
          | Seen by 12
      .content#sponsoredTag(style="border:none;")
        i.left.floated.external.alternate.icon(style="color:gray;")
        .left.floated.meta="Sponsored"
      .ui.two.bottom.attached.icon.buttons
        .ui.reply.button(tabindex='0')
          i.reply.icon
          |  Reply
        //-.ui.flag.button(tabindex='0')
          i.flag.icon
          |  Flag
        .ui.labeled.button(tabindex='0')
          .ui.like.button#likeButton
            i.heart.icon
            |  Like
          a.ui.basic.red.left.pointing.label.count=46
      
      .content
        .ui.comments
          .comment
            a.avatar
              img(src=cdn+'/profile_pictures/user71.JPG')
            .content
              a.author Andrew Thomas
              .metadata
                span.date 3 days ago
                .rating
                  i.heart.icon
                  span.num 3
                  |     Likes
              .text()
                | looks good
              .actions
                a.like.comment Like
                a.flag.comment Flag
          .comment
            a.avatar
              img(src=cdn+'/profile_pictures/user73.JPG')
            .content
              a.author Noah Liebman
              .metadata
                span.date Yesterday
                .rating
                  i.heart.icon
                  span.num 2
                  |     Likes
              .text()
                | can i have discount
              .actions
                a.like.comment Like
                a.flag.comment Flag
      .extra.content
        .ui.fluid.left.labeled.right.icon.input
          .ui.label
            img.ui.avatar.image(src=cdn+'/profile_pictures/'+user.profile.picture, name=user.profile.name)
          input.newcomment(type='text' placeholder='Write a Comment')
          i.big.send.link.icon
            

    .ui.fluid.card.test#step1
      .ui.dimmer.flag
        .content
          .center
            h2.ui.inverted.icon.header
              i.red.flag.icon
              |                                     You &apos;ve flagged this!
              h3.ui.inverted.header
                span The admins will review this post further. We are sorry you had this experience.
      .content
        .right.floated.meta= "Yesterday"
        a(href='/user/neenz03')
              img.ui.avatar.image(src=cdn+'/profile_pictures/user60.jpg')
              span='Nina Ruiz'
      .img.post
        img(src=cdn+'/post_pictures/watermelon.jpg' style='max-width:100%;')
      .content
        .description I love watermelon since 1 yo
      .three.ui.bottom.attached.icon.buttons
        .ui.reply.button(tabindex='0')
          i.reply.icon
          |                             Reply
        .ui.flag.button(tabindex='0')
          i.flag.icon
          |                             Flag
        .ui.labeled.button(tabindex='0')
          .ui.like.button
            i.heart.icon
            |                                 Like
          a.ui.basic.red.left.pointing.label.count 4
      .content
        .ui.comments
          .comment
            a.avatar
              img(src=cdn+'/profile_pictures/user9.jpg')
            .content
              a.author Katherine Zhou
              .metadata
                span.date Yesterday
                .rating
                  i.heart.icon
                  span.num 3
                  |                                             Likes
              .text haha watermelon is the best summer fruit
              .actions
                a.like.comment Like
                a.flag.comment Flag
          .comment
            a.avatar
              img(src=cdn+'/profile_pictures/user5.jpeg')
            .content
              a.author Kiki Pualani
              .metadata
                span.date Yesterday
                .rating
                  i.heart.icon
                  span.num 2
                  |                                             Likes
              .text üçâüçâ
              .actions
                a.like.comment Like
                a.flag.comment Flag
      .extra.content
        .ui.fluid.left.labeled.right.icon.input
          .ui.label
            img.ui.avatar.image(src=cdn+'/profile_pictures/'+user.profile.picture, name=user.profile.name)
          input.newcomment(type='text' placeholder='Write a Comment')
          i.big.send.link.icon
            
    #blueDotStep.ui.fluid.card.dim
      .ui.dimmer.flag
        .content
          .center
            h2.ui.inverted.icon.header
              i.red.flag.icon
              |                                     You &apos;ve reported this ad!
              h3.ui.inverted.header
                span The admins will review this ad further. We are sorry you had this experience.
                
      .ui.inverted.dimmer.notflag
        .content
          .center
            h2.ui.inverted.icon.header
              i.eye.slash.icon(style="color:black;")
              h1.ui.header(style="color:black;") You&apos;ve hidden this ad!
      .content
          
        .ui.right.floated.menu(style="border:none; box-shadow:none;" data-hint="This looks like another sponsored post! Click the three dots and then click ‚ÄúHide ad‚Äù if you don‚Äôt want to see the advertisement, or ‚ÄúReport ad‚Äù if it is inappropriate." data-hintPosition="bottom-right")
          .ui.dropdown.icon.item
            i.ellipsis.horizontal.icon
            .menu.fluid.floated.left#item1
              .item(data-value='0')
                i.fitted.circular.close.icon(style="color:gray;")
                | Hide Ad
              .item(data-value='1')
                i.fitted.circular.exclamation.icon(style="color:gray;")
                | Report Ad
              .item(data-value='2')
                i.fitted.circular.question.icon(style="color:gray;") 
                | Why Am I Seeing This Ad?
                  
        a.left.floated(href='/user/rocknrollcenter')
          img.ui.avatar.image(src=cdn+'/profile_pictures/rocknroll_pfp.jpg')
          span(style="vertical-align:middle;")#companyName="Rock N' Roll Center NY"

      .image
        img.post(src=cdn+'/post_pictures/rocknroll_ad.jpg')

      #step4.content
        .description
          | Learn from legends in the music industry. Sign up for your first month of free guitar lessons today!
          span#hashtag  #sponsored #ad
        //-.right.floated.meta
          i.icon.checkmark
          | Seen by 12
      .content#sponsoredTag(style="border:none;"  data-hint="Remember, you can always ignore the advertisement!" data-hintPosition="middle-middle")
        i.left.floated.external.alternate.icon(style="color:gray;")
        .left.floated.meta="Sponsored"
      .ui.two.bottom.attached.icon.buttons
        .ui.reply.button(tabindex='0')
          i.reply.icon
          |  Reply
        //-.ui.flag.button(tabindex='0')
          i.flag.icon
          |  Flag
        .ui.labeled.button(tabindex='0')
          .ui.like.button#likeButton
            i.heart.icon
            |  Like
          a.ui.basic.red.left.pointing.label.count=57
      
      .content
        .ui.comments
          .comment
            a.avatar
              img(src=cdn+'/profile_pictures/user37.jpg')
            .content
              a.author Daniel Mai
              .metadata
                span.date 5 hours ago
                .rating
                  i.heart.icon
                  span.num 4
                  |     Likes
              .text()
                | Sick
              .actions
                a.like.comment Like
                a.flag.comment Flag
          .comment      
            a.avatar
              img(src=cdn+'/profile_pictures/user71.JPG')
            .content
              a.author Andrew Thomas
              .metadata
                span.date 5 hours ago
                .rating
                  i.heart.icon
                  span.num 2
                  |     Likes
              .text()
                | how can i sign up
              .actions
                a.like.comment Like
                a.flag.comment Flag
      .extra.content
        .ui.fluid.left.labeled.right.icon.input
          .ui.label
            img.ui.avatar.image(src=cdn+'/profile_pictures/'+user.profile.picture, name=user.profile.name)
          input.newcomment(type='text' placeholder='Write a Comment')
          i.big.send.link.icon

    .ui.fluid.card.test#step1
      .ui.dimmer.flag
        .content
          .center
            h2.ui.inverted.icon.header
              i.red.flag.icon
              |                                     You &apos;ve flagged this!
              h3.ui.inverted.header
                span The admins will review this post further. We are sorry you had this experience.
      .content
        .right.floated.meta= "Yesterday"
        a(href='/user/alexa.garcia')
              img.ui.avatar.image(src=cdn+'/profile_pictures/user65.jpg')
              span='Alexa Garcia'
      .image
        img.post(src=cdn+'/post_pictures/dancerstargeted.jpg' style='max-width:100%;')
      .content
        .description Dance is the hidden language of the soul.
      .three.ui.bottom.attached.icon.buttons
        .ui.reply.button(tabindex='0')
          i.reply.icon
          |                             Reply
        .ui.flag.button(tabindex='0')
          i.flag.icon
          |                             Flag
        .ui.labeled.button(tabindex='0')
          .ui.like.button
            i.heart.icon
            |                                 Like
          a.ui.basic.red.left.pointing.label.count 6
      .content
        .ui.comments
          .comment(commentid='5bbd01d88a48061a73337b96')
            a.avatar
              img(src=cdn+'/profile_pictures/unicorn.jpg')
            .content
              a.author Maya Rein
              .metadata
                span.date Yesterday
                .rating
                  i.heart.icon
                  span.num 1
                  |                                             Likes
              .text preach sister
              .actions
                a.like.comment Like
                a.flag.comment Flag
          .comment(commentid='5bbd01d88a48061a73337b96')
            a.avatar
              img(src=cdn+'/profile_pictures/user65.jpg')
            .content
              a.author Alexa Garcia
              .metadata
                span.date Yesterday
                .rating
                  i.heart.icon
                  span.num 1
                  |                                             Likes
              .text haha thanks
              .actions
                a.like.comment Like
                a.flag.comment Flag
      .extra.content
        .ui.fluid.left.labeled.right.icon.input
          .ui.label
            img.ui.avatar.image(src=cdn+'/profile_pictures/'+user.profile.picture, name=user.profile.name)
          input.newcomment(type='text' placeholder='Write a Comment')
          i.big.send.link.icon
                    
    br

    .ui.warning.message#clickAllDotsSim(style="display:none;")
      .header
        | Click through all of the blue dots to continue
    button.ui.big.labeled.icon.button.cybertrans#cyberTransButton
        i.rocket.icon
        |   Let's Continue!
        
        
    .ui.small.modal#whyAmISeeingThisAdModal
      i.close.icon  
      .header Why is Hannah seeing this ad?
      .content
  
      .ui.small.modal#hideAdModal
        i.close.icon  
        .header Why did you choose to hide this ad?
        .content
            .ui.form
               .field
                 .ui.checkbox
                   input(type='checkbox')
                   label The ad was not relevant to me
               .field
                 .ui.checkbox
                   input(type='checkbox')
                   label I see this ad too often
               .field
                 .ui.checkbox
                   input(type='checkbox')
                   label The ad was inappropriate
               br
               .actions
                 .ui.positive.right.labeled.icon.button
                   | Done
                   i.checkmark.icon




block scripts
  script().
     
   

    function startIntro(){
            
        var hints;
        var literacy_counter = 0;
        var intro = introJs().setOptions({ 'hidePrev': true, 'hideNext': true, 'exitOnOverlayClick': false, 'showStepNumbers':false, 'showBullets':false, 'scrollToElement':true, 'doneLabel':'Done &#10003' });
          intro.setOptions({
            steps: [
              {
                element: document.querySelectorAll('#blueDotStep')[0],
                intro: "This is the social media timeline of Hannah, a middle school student. One of Hannah‚Äôs favorite hobbies is playing the guitar.",
                scrollTo: 'tooltip',
                position: 'right'
              },
              {
                element: document.querySelectorAll('#blueDotStep')[0],
                intro: " Recently, she has been watching guitar tutorials on YouTube and looking up cool guitar brands on Google.",
                scrollTo: 'tooltip',
                position: 'right'
              },  
              { 
                element: document.querySelectorAll('#blueDotStep')[0],
                intro: "In this activity, you will see how targeted advertisements work. Click on the blue dots&nbsp;<a role='button' tabindex='0' class='introjs-hint'><div class='introjs-hint-dot'></div><div class='introjs-hint-pulse'></div></a> &nbsp; &nbsp; &nbsp;to learn more...",
                scrollTo: 'tooltip',
                position: 'right'
              }
              
            ]
          });
          intro.start().onexit(function() {
            
            //Activate the dropdown
            $('.ui.dropdown.icon.item').dropdown({
              duration: 300
            });
            
            $('.ui.accordion')
             .accordion();
            
            //Adding functionality to the dropdown
            $('.ui.dropdown.icon.item')
             .dropdown({
               onChange: function() {
                 var dropdownSelection = $(this).data().value
                 if(dropdownSelection == 0){
                   $(".inverted.dimmer").css("background-color","rgba(211,211,211,0.95)");
                   //hide the post
                   var post = $(this).closest(".ui.fluid.card.dim");
                   var postID = post.attr("postID");
                   console.log("***********HIDE: post " + postID);
                   post.find(".ui.inverted.dimmer.notflag").dimmer({
                     closable: false
                   }).dimmer('show')
                   //repeat to ensure its closable
                   post.find(".ui.inverted.dimmer.notflag").dimmer({
                     closable: true
                   })
                     .dimmer('show');
                   //open hida ad Modal
                   $("#hideAdModal").modal('show');
           
                 } else if (dropdownSelection == 1){
                   //flag the post
                   var post = $(this).closest(".ui.fluid.card.dim");
                   var postID = post.attr("postID");
                   console.log("***********FLAG: post " + postID);
                   post.find(".ui.dimmer.flag").dimmer({
                     closable: false
                   })
                     .dimmer('show');
                   //repeat to ensure its closable
                   post.find(".ui.dimmer.flag").dimmer({
                     closable: true
                   })
                     .dimmer('show');
                   
                 } else if (dropdownSelection == 2){
                   //get the company name to dynamically use in the modal
                   var companyName = $(this).closest(".ui.fluid.card.dim").find("#companyName").text();
                   //open info modal
                   $("#whyAmISeeingThisAdModal .content").html(
                     "<p>Hannah is seeing this ad because <b>"+companyName+"</b> wanted to reach people interested in <b>guitars</b>.</p>" +
                     "<p>This is based on what Hannah does on TestDrive, such as pages she has visited and search terms she has clicked on.</p>"+
                     "<br>" +
                     "<div class='actions'>" +
                     "<div class='ui positive right labeled icon button'>Done" +
                     "<i class='checkmark icon'></i></div></div>"
                   );
                   $("#whyAmISeeingThisAdModal").modal('show');
                   
                 }
               }
             });

            hints = introJs().addHints();
            console.log('hints added')
            hints.onhintclose(function(e) {
             literacy_counter++;
             if(literacy_counter == 5) {
               $("#clickAllDotsSim").hide();
               $( ".cybertrans" ).addClass("green");
             }
           });
          
          //I'm not sure if this is a stable solution, but it seems to work. Keep this and implement later.
          //use this to get the current step - each hint has a predefined number. Use to keep a record for if each has been clicked
          /*hints.onhintclick(function(){
            console.log("CLICKED A HINT!");
            setTimeout(function(){
              console.log(hints._currentStep);
            }, 100);
          });*/
          
        });
        
        
        
        //error messaging
        $('#cyberTransButton').on('click', function() {
          if(literacy_counter != 5){
            $('#clickAllDotsSim').show();
          }
        });
          
      };

      $(window).on("load", function() {startIntro();});
